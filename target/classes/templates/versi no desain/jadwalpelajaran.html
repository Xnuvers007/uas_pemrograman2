<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jadwal Pelajaran</title>
    <script>
        function submitForm(method, id) {
            var form = document.getElementById("jadwalPelajaranForm");
            var formData = new FormData(form);

            var xhr = new XMLHttpRequest();
            if (method === 'POST') {
                xhr.open("POST", "/api/jadwalpelajaran", true);
            } else if (method === 'PUT') {
                xhr.open("PUT", "/api/jadwalpelajaran/" + id, true);
            } else if (method === 'DELETE') {
                xhr.open("DELETE", "/api/jadwalpelajaran/" + id, true);
            }

            xhr.setRequestHeader("Content-Type", "application/json");

            xhr.onload = function () {
                if (xhr.status === 200 || xhr.status === 204) {
                    alert('Operasi berhasil!');
                    form.reset();
                    refreshJadwalPelajaranTable(); // Refresh tabel setelah operasi CRUD
                } else {
                    alert('Operasi gagal!');
                }
            };

            var jsonData = {
                hari: formData.get('hari'),
                idGuru: formData.get('idGuru'),
                idKelas: formData.get('idKelas'),
                mataPelajaran: { id: formData.get('idMapel') },
                siswa: { id: formData.get('idSiswa') },
                jamMulai: formData.get('jamMulai'),
                jamSelesai: formData.get('jamSelesai')
            };

            xhr.send(JSON.stringify(jsonData));
        }

        function editJadwalPelajaran(id) {
            var xhr = new XMLHttpRequest();
            xhr.open("GET", "/api/jadwalpelajaran/" + id, true);
            xhr.onload = function () {
                if (xhr.status === 200) {
                    var jadwalPelajaran = JSON.parse(xhr.responseText);

                    // Isi formulir dengan data jadwalPelajaran yang akan diubah
                    document.getElementById("id").value = jadwalPelajaran.id;
                    document.getElementById("hari").value = jadwalPelajaran.hari;
                    document.getElementById("idGuru").value = jadwalPelajaran.idGuru;
                    document.getElementById("idKelas").value = jadwalPelajaran.idKelas;
                    document.getElementById("idMapel").value = jadwalPelajaran.mataPelajaran.id;
                    document.getElementById("idSiswa").value = jadwalPelajaran.siswa.id;
                    document.getElementById("jamMulai").value = jadwalPelajaran.jamMulai;
                    document.getElementById("jamSelesai").value = jadwalPelajaran.jamSelesai;
                } else {
                    alert('Gagal mendapatkan data jadwal pelajaran.');
                }
            };
            xhr.send();
        }

        function deleteJadwalPelajaran(id) {
            if (confirm('Apakah Anda yakin ingin menghapus jadwal pelajaran ini?')) {
                var xhr = new XMLHttpRequest();
                xhr.open("DELETE", "/api/jadwalpelajaran/" + id, true);
                xhr.onload = function () {
                    if (xhr.status === 204) {
                        alert('Jadwal pelajaran berhasil dihapus!');
                        refreshJadwalPelajaranTable(); // Refresh tabel setelah penghapusan
                    } else {
                        alert('Gagal menghapus jadwal pelajaran.');
                    }
                };
                xhr.send();
            }
        }

        function refreshJadwalPelajaranTable() {
            var xhr = new XMLHttpRequest();
            xhr.open("GET", "/api/jadwalpelajaran", true);
            xhr.onload = function () {
                if (xhr.status === 200) {
                    var jadwalPelajaranList = JSON.parse(xhr.responseText);
                    var tableBody = document.getElementById("jadwalPelajaranTableBody");
                    tableBody.innerHTML = "";

                    jadwalPelajaranList.forEach(function (jadwalPelajaran) {
                        var row = document.createElement("tr");
                        row.innerHTML = `
                            <td>${jadwalPelajaran.id}</td>
                            <td>${jadwalPelajaran.hari}</td>
                            <td>${jadwalPelajaran.idGuru}</td>
                            <td>${jadwalPelajaran.idKelas}</td>
                            <td>${jadwalPelajaran.mataPelajaran.namaMapel}</td>
                            <td>${jadwalPelajaran.mataPelajaran.id}</td>
                            <td>${jadwalPelajaran.siswa.namaLengkap}</td>
                            <td>${jadwalPelajaran.siswa.id}</td>
                            <td>${jadwalPelajaran.jamMulai}</td>
                            <td>${jadwalPelajaran.jamSelesai}</td>
                            <td>
                                <button type="button" onclick="editJadwalPelajaran(${jadwalPelajaran.id})">Edit</button>
                                <button type="button" onclick="deleteJadwalPelajaran(${jadwalPelajaran.id})">Delete</button>
                            </td>
                        `;
                        tableBody.appendChild(row);
                    });
                } else {
                    alert('Gagal memuat data jadwal pelajaran.');
                }
            };
            xhr.send();
        }

        function populateDropdowns() {
            var xhrMapel = new XMLHttpRequest();
            xhrMapel.open("GET", "/api/matapelajaran", true);
            xhrMapel.onload = function () {
                if (xhrMapel.status === 200) {
                    var mapelList = JSON.parse(xhrMapel.responseText);
                    var mapelSelect = document.getElementById("idMapel");
                    mapelList.forEach(function (mapel) {
                        var option = document.createElement("option");
                        option.value = mapel.id;
                        option.text = mapel.namaMapel;
                        mapelSelect.appendChild(option);
                    });
                } else {
                    alert('Gagal memuat data mata pelajaran.');
                }
            };
            xhrMapel.send();

            var xhrSiswa = new XMLHttpRequest();
            xhrSiswa.open("GET", "/api/siswa", true);
            xhrSiswa.onload = function () {
                if (xhrSiswa.status === 200) {
                    var siswaList = JSON.parse(xhrSiswa.responseText);
                    var siswaSelect = document.getElementById("idSiswa");
                    siswaList.forEach(function (siswa) {
                        var option = document.createElement("option");
                        option.value = siswa.id;
                        option.text = siswa.namaLengkap;
                        siswaSelect.appendChild(option);
                    });
                } else {
                    alert('Gagal memuat data siswa.');
                }
            };
            xhrSiswa.send();
        }

        window.onload = function () {
            refreshJadwalPelajaranTable();
            populateDropdowns();
        };

        function checkapi() {
            window.location.href = "/api/jadwalpelajaran";
        }
    </script>
</head>
<body>
    <h1>Jadwal Pelajaran</h1>

    <form id="jadwalPelajaranForm">
        <input type="hidden" id="id" name="id"/>
        
        <label for="hari">Hari:</label>
        <select id="hari" name="hari">
            <option value="senin">Senin</option>
            <option value="selasa">Selasa</option>
            <option value="rabu">Rabu</option>
            <option value="kamis">Kamis</option>
            <option value="jumat">Jumat</option>
            <option value="sabtu">Sabtu</option>
        </select><br/><br/>
        
        <label for="idGuru">ID Guru:</label>
        <input type="text" id="idGuru" name="idGuru"/><br/><br/>
        
        <label for="idKelas">ID Kelas:</label>
        <input type="text" id="idKelas" name="idKelas"/><br/><br/>
        
        <label for="idMapel">Mata Pelajaran:</label>
        <select id="idMapel" name="idMapel">
            <!-- Options akan di-generate oleh JavaScript -->
        </select><br/><br/>
        
        <label for="idSiswa">Siswa:</label>
        <select id="idSiswa" name="idSiswa">
            <!-- Options akan di-generate oleh JavaScript -->
        </select><br/><br/>
        
        <label for="jamMulai">Jam Mulai:</label>
        <input type="text" id="jamMulai" name="jamMulai"/><br/><br/>
        
        <label for="jamSelesai">Jam Selesai:</label>
        <input type="text" id="jamSelesai" name="jamSelesai"/><br/><br/>
        
        <button type="button" onclick="submitForm('POST')">Tambah</button>
        <button type="button" onclick="submitForm('PUT', document.getElementById('id').value)">Ubah</button>
        <button type="button" onclick="checkapi()">Check API</button>
        <button type="button" onclick="clearForm()">Batal</button>
    </form>

    <h2>Data Jadwal Pelajaran</h2>
    <table border="1">
        <thead>
            <tr>
                <th>ID</th>
                <th>Hari</th>
                <th>ID Guru</th>
                <th>ID Kelas</th>
                <th>Mata Pelajaran</th>
                <th>ID Mapel</th>
                <th>Siswa</th>
                <th>ID Siswa</th>
                <th>Jam Mulai</th>
                <th>Jam Selesai</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="jadwalPelajaranTableBody">
            <!-- Data jadwal pelajaran akan ditampilkan di sini -->
        </tbody>
    </table>
</body>
</html>